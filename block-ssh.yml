version: 2.1

commands:
    checksession:
        description: |
            Build and tag a Docker image
        steps:
          - run: 
              name: Fail on SSH Reruns
              command: |
                echo "Am I SSH?"
                KEYS=`jq '.Dispatched.PreAuthorizedSshKeys[].UserId' /.circleci-runner-config.json 2>/dev/null || echo ""`
                echo $KEYS
                if [[ "x$KEYS" != "x" ]];then
                  echo "YES, Public keys are provided, this is SSH job, failing now."
                  circleci-agent step halt && exit 1
                else
                  echo "NO, no public keys enabled, job may pass."
                fi
     
